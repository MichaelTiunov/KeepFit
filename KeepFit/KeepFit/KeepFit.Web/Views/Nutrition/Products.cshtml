@using KeepFit.Core.Models
@model  KeepFit.Web.Models.Nutrition.ProductsModel
<style>
    .item {
        background: none repeat scroll 0 0 #888888;
        color: #262524;
        float: left;
        height: 100px;
        margin: 5px;
        padding: 10px;
        position: relative;
        width: 150px;
        -ms-border-radius: 5px;
        border-radius: 5px;
    }

    .iso-container {
        height: 300px;
        overflow-y: auto;
    }
</style>
<div id="filters" class="button-filter-group js-radio-button-group">
    @foreach (ProductType type in Model.ProductTypes)
    {
        <button class="ladda-button button-filter" data-style="expand-left" data-filter="@type.ProductTypeId">@type.Name</button>
    }
</div>
<div class="iso-container">
    @foreach (Product product in Model.Products)
    {
        <div class="item @product.ProductTypeId" data-category="@product.ProductTypeId">
            @product.Name
        </div>
    }
</div>

<script src="~/Scripts/jquery.infinitescroll.js"></script>
<script>
    $(function () {
        var $container = $('.iso-container').isotope({
            itemSelector: '.item',
            layoutMode: 'fitRows',
            transitionDuration: '0.6s',
            animationOptions: {
                duration: 750,
                easing: 'linear',
                queue: false,
            }
        });

        $('.button-filter-group').on('click', 'button', function () {
            var filterValue = $(this).attr('data-filter');
            var l = Ladda.create(this);
            getProducts(filterValue, l);
        });

        function getProducts(typeId, l) {
            l.start();

            $.ajax('@Url.Action("GetProducts", "Nutrition")',
            {
                type: 'POST',
                dataType: 'json',
                data: { typeId: typeId },
                success: function (result) {
                    var container = $('<div/>');


                    $.each(result, function (i, v) {
                        $('#productsTmpl').tmpl({ productName: v.Name, productType: v.ProductTypeId }).appendTo(container);
                    });
                    $container.empty().append(container.html()).isotope('insert', container.html());

                },
                error: function (result) {
                    alert('Error!');
                }
            }).done(function () {
                l.stop();
            });
        }
    });
</script>
<script id="productsTmpl" type="text/x-jquery-tmpl">
    <div class="item" data-category="${productType}">
        ${productName}
    </div>
</script>

